let currentBook = '';
let currentChapter = '';
let currentVerse = '';

async function loadDailyVerse() {
    try {
        let biblePath = "Bible%20Versions/NIV/NIV_bible.json";
        const path = window.location.pathname;

        if (path.includes("/pages/") || path.includes("\\pages\\")) {
            biblePath = "../Bible%20Versions/NIV/NIV_bible.json";
        }

        const response = await fetch(biblePath);

        if (!response.ok) {
            throw new Error("Failed to load JSON (" + response.status + ")");
        }

        const bible = await response.json();

        const today = new Date();
        const seed = today.getFullYear() + "-" + (today.getMonth() + 1) + "-" + today.getDate();

        function seededRandom(seedStr) {
            let hash = 0;
            for (let i = 0; i < seedStr.length; i++) {
                hash = seedStr.charCodeAt(i) + ((hash << 5) - hash);
            }
            return (Math.abs(hash) % 1000000) / 1000000;
        }

        const books = Object.keys(bible);
        const book = books[Math.floor(seededRandom(seed) * books.length)];
        const chapters = Object.keys(bible[book]);
        const chapter = chapters[Math.floor(seededRandom(seed + "c") * chapters.length)];
        const verses = Object.keys(bible[book][chapter]);
        const verse = verses[Math.floor(seededRandom(seed + "v") * verses.length)];

        const verseText = bible[book][chapter][verse];

        currentBook = book;
        currentChapter = chapter;
        currentVerse = verse;

        document.getElementById("verse-text").textContent = verseText;
        document.getElementById("verse-text").classList.remove('loading');
        document.getElementById("verse-ref").textContent = `${book} ${chapter}:${verse}`;
    } catch (err) {
        console.error("Error loading verse:", err);
        document.getElementById("verse-text").textContent = "Unable to load verse. Please check the Bible file path.";
        document.getElementById("verse-text").classList.remove('loading');
    }
}

loadDailyVerse();